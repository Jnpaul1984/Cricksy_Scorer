# Cricksy Scorer - Repository Structure Reference

**Purpose**: Living document tracking complete repository structure, file purposes, and ownership  
**Last Updated**: December 21, 2025  
**Maintainers**: Development Team  
**Update Frequency**: When new files/directories are added

---

## ROOT LEVEL FILES

### Configuration Files
| File | Purpose | Type |
|------|---------|------|
| `pyproject.toml` | Python project config (build, ruff, mypy, pytest) | Config |
| `ruff.toml` | Ruff linter/formatter rules | Config |
| `pyrightconfig.json` | Pyright type checker config | Config |
| `.pre-commit-config.yaml` | Pre-commit hook definitions | Config |
| `package.json` | Node.js dependencies, npm scripts | Config |
| `.env.example` | Example environment variables template | Config |
| `docker-compose.yml` | Production Docker setup | Docker |
| `docker-compose.dev.yml` | Development Docker setup | Docker |
| `docker-compose.test.yml` | Test Docker setup | Docker |
| `docker-compose.ci.yml` | CI/CD Docker setup | Docker |
| `Dockerfile` | Root Dockerfile (usually backend) | Docker |

### Firebase & Deployment
| File | Purpose | Type |
|------|---------|------|
| `firebase.json` | Firebase hosting config | Config |
| `.firebaserc` | Firebase project settings | Config |
| `taskdef.json` | AWS ECS task definition | Infra |
| `new-taskdef.json` | New ECS task definition (staging) | Infra |
| `registered-taskdef.json` | Registered ECS task definition | Infra |
| `local-deploy.sh` | Local deployment script | Script |

### Documentation Files
| File | Purpose | Type |
|------|---------|------|
| `README.md` | Project overview and getting started | Docs |
| `TESTING.md` | Testing guide and strategies | Docs |
| `TIER_ENTITLEMENT_ARCHITECTURE_BLUEPRINT.md` | Tier/pricing architecture | Docs |
| `REPOSITORY_STRUCTURE.md` | This file - repo structure reference | Docs |
| `FINAL_WORKFLOW_FIX_SUMMARY.md` | Workflow fixes summary | Docs |
| `IMPLEMENTATION_SUMMARY.md` | Implementation status | Docs |
| `DOCUMENTATION_INDEX.md` | Index of all documentation | Docs |

### Git & Version Control
| File | Purpose | Type |
|------|---------|------|
| `.gitignore` | Git ignore rules | Config |
| `.git/` | Git repository data | System |
| `.github/` | GitHub workflows and config | Config |

### Development Tools
| File | Purpose | Type |
|------|---------|------|
| `conftest.py` | Pytest shared fixtures (root level) | Test |
| `.vscode/` | VS Code settings and extensions | Config |
| `.env` | Local environment variables (DO NOT COMMIT) | Local |
| `.venv/` | Python virtual environment | System |

---

## BACKEND DIRECTORY: `backend/`

### Core Application Files

| File | Purpose | Owner |
|------|---------|-------|
| `main.py` | Entry point (production uvicorn) | Backend Team |
| `app.py` | FastAPI application factory (create_app) | Backend Team |
| `config.py` | Environment config, database URL, settings | DevOps Team |
| `security.py` | JWT auth, RBAC, require_roles() decorator | Auth Team |
| `socket_handlers.py` | Socket.IO event handlers (presence, updates) | Real-time Team |

### Database Layer: `backend/sql_app/`

| File | Purpose | Lines | Owner |
|------|---------|-------|-------|
| `models.py` | SQLAlchemy ORM models (User, Game, CoachingSession, etc.) | ~1,200 | DB Team |
| `schemas.py` | Pydantic DTO schemas for API requests/responses | ~500 | API Team |
| `database.py` | AsyncSession factory, get_db() dependency | ~50 | DB Team |

### Database Migrations: `backend/alembic/`

| Item | Purpose |
|------|---------|
| `alembic.ini` | Alembic configuration (SQLAlchemy) |
| `env.py` | Alembic migration environment |
| `script.py.mako` | Migration template |
| `versions/` | Migration files (auto-generated by `alembic revision`) |

### Routes/API Endpoints: `backend/routes/`

| File | Purpose | Endpoints | Owner |
|------|---------|-----------|-------|
| `auth_router.py` | Login, register, token refresh | POST /auth/* | Auth Team |
| `users_router.py` | User profile, settings, preferences | GET/PUT /users/* | User Team |
| `coach_pro.py` | Coach-tier routes (assignments, sessions) | /api/coaches/* | Coach Team |
| `analyst_pro.py` | Analyst-tier routes (analytics, exports) | /api/analysts/* | Analyst Team |
| `fan_mode.py` | Free-tier fan match creation | /api/fan/* | Fan Mode Team |
| `billing.py` | Subscription, plans, entitlements | GET /billing/* | Billing Team |
| `games.py` | Game CRUD and state management | /api/games/* | Game Team |
| `gameplay.py` | Scoring, deliveries, innings | /api/games/{id}/deliveries | Scoring Team |
| `tournaments.py` | Tournament management | /api/tournaments/* | Tournament Team |
| `players.py` | Player profiles, stats | /api/players/* | Player Team |

### Services/Business Logic: `backend/services/`

| File | Purpose | Owner |
|------|---------|-------|
| `scoring_service.py` | Core scoring logic (score_one, deliveries) | Scoring Team |
| `billing_service.py` | PLAN_FEATURES, entitlement checks, usage limits | Billing Team |
| `live_bus.py` | Socket.IO broadcasting, real-time updates | Real-time Team |
| `coaching_service.py` | Coach session management | Coach Team |
| `player_service.py` | Player profile, career calculations | Player Team |
| `tournament_service.py` | Tournament logic and state | Tournament Team |
| `ai_service.py` | AI predictions, reports (mock/placeholder) | ML Team |
| `video_service.py` | Video upload, playback (FUTURE) | Video Team |
| `dls/` | Duckworth-Lewis-Stern calculations | DLS Team |
| `mcp_tools/` | MCP tool implementations | MCP Team |

### Domain Rules: `backend/domain/`

| File | Purpose | Owner |
|------|---------|-------|
| `constants.py` | Cricket rules (dismissal types, extras, roles) | Cricket Rules Team |
| `enums.py` | Enum definitions | Data Team |

### Middleware: `backend/middleware/`

| File | Purpose | Owner |
|------|---------|-------|
| `observability.py` | Tracing, metrics collection | Observability Team |
| `request_logging.py` | Request/response logging | Observability Team |

### ML Models: `backend/ml_models/`

| Item | Purpose | Owner |
|------|---------|-------|
| `*.pkl` / `*.joblib` | Trained prediction models (score, win probability) | ML Team |
| `training_data.csv` | Training dataset for models | ML Team |

### Testing: `backend/tests/`

| File | Purpose | Type |
|------|---------|------|
| `test_scoring.py` | Scoring service unit tests | Unit |
| `test_rbac.py` | Auth & role-based access tests | Unit |
| `test_tournament.py` | Tournament logic tests | Unit |
| `integration/` | Integration tests (requires DB) | Integration |

### Utilities & Helpers: `backend/utils/`

| File | Purpose | Owner |
|------|---------|-------|
| `helpers.py` | Utility functions | Backend Team |
| `validation_helpers.py` | Input validation, data sanitization | Backend Team |

### Scripts: `backend/scripts/`

| File | Purpose | Type |
|------|---------|------|
| `seed_database.py` | Seed test data | Setup |
| `train_models.py` | Train ML models | ML |

### Other Files

| File | Purpose |
|------|---------|
| `requirements.txt` | Python dependencies (pip install) |
| `requirements-dev.txt` | Development dependencies |
| `pytest.ini` | Pytest configuration |
| `pyproject.toml` | Poetry/pip config (backend-specific) |
| `conftest.py` | Backend pytest fixtures |
| `.dockerignore` | Files to exclude from Docker image |
| `Dockerfile` | Container image definition |
| `static/` | Static files (sponsor images, etc.) |
| `docs/` | Backend-specific documentation |

---

## FRONTEND DIRECTORY: `frontend/`

### Core Configuration

| File | Purpose | Owner |
|------|---------|-------|
| `package.json` | Node.js dependencies, npm scripts | Frontend Team |
| `vite.config.ts` | Vite bundler configuration | Build Team |
| `tsconfig.json` | TypeScript configuration | Frontend Team |
| `eslint.config.js` | ESLint rules (code style) | Frontend Team |
| `.prettierrc.json` | Prettier code formatting | Frontend Team |
| `index.html` | HTML entry point | Frontend Team |

### Source Code: `frontend/src/`

#### Stores (Pinia State Management): `src/stores/`

| File | Purpose | Owner |
|------|---------|-------|
| `authStore.ts` | User, role, tier, permissions state | Auth Team |
| `gameStore.ts` | Game state, Socket.IO sync | Game Team |
| `index.ts` | Store exports | Frontend Team |

#### Views (Page Components): `src/views/`

| File | Purpose | Owner |
|------|---------|-------|
| `PricingPageView.vue` | Pricing page with plan cards | Marketing Team |
| `CoachesDashboardView.vue` | Coach tier dashboard | Coach Team |
| `AnalystWorkspaceView.vue` | Analyst tier workspace | Analyst Team |
| `FanModeView.vue` | Free-tier fan match creation | Fan Mode Team |
| `GameDetailView.vue` | Game scoring screen | Game Team |
| `PlayerProfileView.vue` | Player career/stats view | Player Team |

#### Components (Reusable UI): `src/components/`

| File | Purpose | Owner |
|------|---------|-------|
| `Paywall.vue` | Upgrade prompt (FUTURE) | Monetization Team |
| `FeatureGate.vue` | "Upgrade to unlock" overlay (FUTURE) | Monetization Team |
| `ScorecardForm.vue` | Delivery input form | Scoring Team |
| `LiveScoreboard.vue` | Live score display | Game Team |
| `PlayerCard.vue` | Player profile card | Player Team |

#### Services (API Calls): `src/services/`

| File | Purpose | Owner |
|------|---------|-------|
| `api.ts` | HTTP client with auth header injection | API Team |
| `auth.ts` | Login, logout, getCurrentUser() | Auth Team |
| `game.ts` | Game CRUD, scoring requests | Game Team |
| `player.ts` | Player profile requests | Player Team |

#### Types (TypeScript Interfaces): `src/types/`

| File | Purpose | Owner |
|------|---------|-------|
| `auth.ts` | AuthUser, UserRole, SubscriptionInfo types | Auth Team |
| `game.ts` | Game, Delivery, Innings types | Game Team |
| `pricing.ts` | PlanDef, EntitlementLevel types (NEW) | Pricing Team |
| `index.ts` | Type exports | Frontend Team |

#### Router (Navigation): `src/router/`

| File | Purpose | Owner |
|------|---------|-------|
| `index.ts` | Vue Router setup, role-based redirects | Frontend Team |

#### Utilities: `src/utils/`

| File | Purpose | Owner |
|------|---------|-------|
| `helpers.ts` | Frontend utility functions | Frontend Team |
| `constants.ts` | App-wide constants | Frontend Team |

### Public Assets: `frontend/public/`

| Item | Purpose |
|------|---------|
| `favicon.ico` | Browser tab icon |
| `sponsors/` | Sponsor logos |
| `teams/` | Team logos |

### Tests: `frontend/tests/`

| Item | Purpose |
|------|---------|
| `unit/` | Vitest unit tests |
| `*.spec.ts` | Component/util tests |

### E2E Tests: `frontend/cypress/`

| File | Purpose |
|------|---------|
| `cypress.config.ts` | Cypress configuration |
| `e2e/` | E2E test files |
| `support/` | Cypress plugins, helpers |
| `fixtures/` | Mock data for tests |

### Other Files

| File | Purpose |
|------|---------|
| `dist/` | Production build output |
| `node_modules/` | Node.js dependencies |
| `Dockerfile` | Frontend container image |
| `E2E_TESTS_README.md` | E2E testing guide |

---

## DOCUMENTATION DIRECTORY: `docs/`

| File | Purpose | Owner |
|------|---------|-------|
| `CORE_SCORING_SYSTEM.md` | Scoring architecture deep-dive | Scoring Team |
| `PLAYER_PROFILES.md` | Player profile data model | Player Team |
| `TOURNAMENT_API.md` | Tournament API specification | Tournament Team |
| `AI_PREDICTION_FEATURE.md` | AI predictions (scoring, win probability) | ML Team |
| `continuous_improvement_guide.md` | Code quality guidelines | QA Team |
| `long_term_testing_strategy.md` | Testing roadmap | QA Team |
| `agents/` | AI agent documentation | AI Team |
| `beta/` | Beta feature documentation | Product Team |

---

## INFRASTRUCTURE DIRECTORY: `infra/`

| Item | Purpose | Owner |
|------|---------|-------|
| `terraform/` | Infrastructure as Code (AWS, databases) | DevOps Team |
| `kubernetes/` | Kubernetes manifests (if applicable) | DevOps Team |
| `scripts/` | Deployment scripts | DevOps Team |

---

## TESTING DIRECTORY: `tests/`

| Item | Purpose | Owner |
|------|---------|-------|
| `unit/` | Unit tests (fast, isolated) | QA Team |
| `integration/` | Integration tests (DB, external services) | QA Team |
| `e2e/` | End-to-end tests (full workflows) | QA Team |

---

## SCRIPTS & TOOLS

| Directory | Purpose |
|-----------|---------|
| `scripts/` | Utility scripts (setup, deploy, seed) |
| `tools/` | Development tools and analyzers |
| `.github/workflows/` | CI/CD workflows (GitHub Actions) |

---

## KEY METRICS

| Metric | Value | Notes |
|--------|-------|-------|
| **Backend Python Files** | ~50+ | Models, routes, services, tests |
| **Frontend Vue/TS Files** | ~30+ | Stores, views, components, services |
| **Database Models** | 20+ | User, Game, CoachingSession, etc. |
| **API Endpoints** | 100+ | REST routes across all domains |
| **Test Files** | 30+ | Pytest + Cypress + Vitest |

---

## DIRECTORY TREE (SIMPLIFIED)

```
Cricksy_Scorer/
├── backend/                          # Python/FastAPI backend
│   ├── sql_app/
│   │   ├── models.py                 # ORM models
│   │   ├── schemas.py                # Pydantic DTOs
│   │   └── database.py               # DB connection
│   ├── routes/                       # API endpoints
│   │   ├── auth_router.py
│   │   ├── coach_pro.py
│   │   ├── analyst_pro.py
│   │   ├── fan_mode.py
│   │   ├── billing.py
│   │   └── ...
│   ├── services/                     # Business logic
│   │   ├── scoring_service.py
│   │   ├── billing_service.py
│   │   ├── live_bus.py
│   │   ├── video_service.py          # NEW
│   │   └── ...
│   ├── domain/                       # Cricket rules
│   │   ├── constants.py
│   │   └── enums.py
│   ├── tests/                        # Test suite
│   │   ├── test_scoring.py
│   │   ├── test_rbac.py
│   │   └── integration/
│   ├── alembic/                      # Database migrations
│   │   ├── env.py
│   │   └── versions/
│   ├── security.py                   # JWT + RBAC
│   ├── app.py                        # App factory
│   ├── main.py                       # Entry point
│   ├── config.py                     # Settings
│   └── requirements.txt              # Dependencies
│
├── frontend/                         # Vue 3 + TypeScript frontend
│   ├── src/
│   │   ├── stores/                   # Pinia state
│   │   │   ├── authStore.ts
│   │   │   └── gameStore.ts
│   │   ├── views/                    # Page components
│   │   │   ├── PricingPageView.vue
│   │   │   ├── CoachesDashboardView.vue
│   │   │   └── ...
│   │   ├── components/               # Reusable UI
│   │   │   ├── Paywall.vue           # NEW
│   │   │   ├── FeatureGate.vue       # NEW
│   │   │   └── ...
│   │   ├── services/                 # API calls
│   │   │   ├── api.ts
│   │   │   ├── auth.ts
│   │   │   └── ...
│   │   ├── types/                    # TS interfaces
│   │   │   ├── auth.ts
│   │   │   ├── pricing.ts            # NEW
│   │   │   └── ...
│   │   └── router/                   # Vue Router
│   ├── cypress/                      # E2E tests
│   │   └── e2e/
│   ├── package.json
│   ├── vite.config.ts
│   └── tsconfig.json
│
├── docs/                             # Documentation
│   ├── CORE_SCORING_SYSTEM.md
│   ├── TOURNAMENT_API.md
│   ├── AI_PREDICTION_FEATURE.md
│   └── ...
│
├── infra/                            # Infrastructure
│   ├── terraform/
│   └── kubernetes/
│
├── pyproject.toml                    # Python config
├── package.json                      # Node.js config
├── docker-compose.yml                # Dev stack
├── Dockerfile                        # Backend image
├── README.md                         # Project overview
├── TIER_ENTITLEMENT_ARCHITECTURE_BLUEPRINT.md
└── REPOSITORY_STRUCTURE.md           # This file
```

---

## IMPORTANT CONVENTIONS

### File Organization
- **Models** live in `backend/sql_app/models.py` (single source of truth)
- **Routes** are organized by domain/tier (e.g., `coach_pro.py`, `analyst_pro.py`)
- **Services** contain business logic separate from routes
- **Frontend stores** are Pinia modules with async actions
- **Components** are atomic and reusable

### Import Patterns
- **Backend**: Absolute imports from project root
  ```python
  from backend.sql_app import models
  from backend.services.billing_service import PLAN_FEATURES
  ```
- **Frontend**: Aliased imports
  ```typescript
  import { useAuthStore } from '@/stores/authStore'
  import type { AuthUser } from '@/types/auth'
  ```

### Tier Architecture Files
- **RoleEnum**: `backend/sql_app/models.py:57-65` (defines all tiers: free, player_pro, scorers_pro, coach_pro, analyst_pro, org_pro)
- **Plan Features**: `backend/services/billing_service.py:20-100` (PLAN_FEATURES dict with entitlements)
- **RBAC Decorator**: `backend/security.py:228-239` (require_roles() for route protection)
- **Auth Getters**: `frontend/src/stores/authStore.ts:31-56` (isCoachPro, isAnalystPro, etc.)
- **Pricing Display**: `frontend/src/views/PricingPageView.vue:170-290` (Plan card definitions)

### Recent Additions (2025-12-21)
- ✅ **Player Pro** ($1.99/month) - new base tier
- ✅ **Scorers Pro** ($9.99/month) - specialist tier
- ✅ **Plus Tier Support** - framework for Plus variants
- ✅ **Video Service** (framework) - video_service.py
- ✅ **Coach Pro Plus** (planned) - video sessions + AI reports
- ✅ **Scorers Pro Plus** (planned) - broadcast integration + multi-venue

---

## MAINTENANCE CHECKLIST

When adding new files/directories:

- [ ] Add entry to appropriate section above
- [ ] Note file purpose and owner
- [ ] Update line count if applicable
- [ ] Add to directory tree (if major addition)
- [ ] Link to any related documentation
- [ ] Update "Recent Additions" section with date
- [ ] Commit changes with message: `docs: update REPOSITORY_STRUCTURE.md`

### Quick Updates

**Adding a new route file?**
- Add to `backend/routes/` with descriptive name
- Link to owner in this document
- Add corresponding endpoints documentation

**Adding a new service?**
- Add to `backend/services/` 
- Document its purpose and dependencies
- Add corresponding tests in `backend/tests/`

**Adding a new component?**
- Add to `frontend/src/components/`
- Document purpose and props/emits
- Add Vitest unit tests

**Adding a new tier?**
- Update RoleEnum in `backend/sql_app/models.py`
- Add PLAN_FEATURES entry in `backend/services/billing_service.py`
- Add getter in `frontend/src/stores/authStore.ts`
- Update tier matrix in `TIER_ENTITLEMENT_ARCHITECTURE_BLUEPRINT.md`
- Update pricing page in `frontend/src/views/PricingPageView.vue`

---

## REFERENCES

- **Tier Architecture**: [TIER_ENTITLEMENT_ARCHITECTURE_BLUEPRINT.md](TIER_ENTITLEMENT_ARCHITECTURE_BLUEPRINT.md)
- **Testing Guide**: [TESTING.md](TESTING.md)
- **Scoring System**: [docs/CORE_SCORING_SYSTEM.md](docs/CORE_SCORING_SYSTEM.md)
- **Tournament API**: [docs/TOURNAMENT_API.md](docs/TOURNAMENT_API.md)

---

**Document Status**: ✅ ACTIVE  
**Next Review**: When new major features are added  
**Questions?** Check the architecture blueprint or reach out to team lead.
